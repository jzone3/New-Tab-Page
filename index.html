<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="search.css" />

	<title>Search</title>

	<script src="jquery-1.8.2.min.js"></script>

</head>
<body background="bg2.png">
	<form id="searchbox">
		<input id="search" class="noEnterSubmit" type="text" placeholder="Type here" autocomplete="off" autofocus="autofocus" spellcheck="false">
		<!-- <input id="submit" type="submit" value="Search"> -->
	</form>

	<div id="results" style="display: none;">
		<div id="actualResults"></div>
	</div>

	<script type="text/javascript">
		var shown = false;

		$('.noEnterSubmit').keypress(function(e){
			if ( e.which == 13 ) {
				$.ajax({
					type:'GET',
					url:'http://api.duckduckgo.com/',
					dataType: 'jsonp',
					crossDomain: true,
					data: {
						q: $('#search')[0].value,
						// o: "json",
						format: 'json'
					},
					success: function(response) {
						if (!shown && emptyResponse(response)) {
							formatResponse(response);
							$('#results').show();
							$('#results').animate({
								height: "360px",
								padding: "20px 20px",
							}, 'slow');
							shown = true;
						}
						else if (emptyResponse(response)) {
							$('#actualResults').fadeOut('fast');
							$(':animated').promise().done(function() {
								formatResponse(response);
								$('#actualResults').fadeIn('slow');
							});
						}
					}
				});

				return false
			}
		});

		function emptyResponse(response) {
			$.each(response, function() {
				$.each(this, function(k, v) {
					if (v != "") {
						return false;
					}
				});
			});
			return true;
		}

		function formatResponse(response) {
			if (response.Image != "") {
				$('#actualResults').html('<img src="' + response.Image + '" style="float: left; padding-right: 20px; padding-top: 0;"><h1>' + response.Heading + '</h1><br/>' + response.Abstract + '<br/>');
			}
			else if (response.Abstract != "") {
				$('#actualResults').html('<h1>' + response.Heading + '</h1><br/>' + response.Abstract + '<br/>');
			}
			else if (response.Answer != "") {
				$('#actualResults').html('<h1>' + response.Answer + '</h1>');
			}
			else {
				$('#actualResults').append("<ul>");
				$('#actualResults').append(response.RelatedTopics.forEach(disambiguation));
				alert($('#actualResults')[0].value);
				$('#actualResults').append("</ul>");
			}
		}

		function disambiguation(element) {
			return '<li>' + element.Text + '</li>';
		}
	</script>
</body>
</html>
